---
title: "project"
author: "tri doan"
date: "Saturday, April 25, 2015"
output: pdf_documenta
---

For its simplicity, I download  two datasets and do exploratory analysis

At first, I see blank columns that in fact contains kind of data like "#DIV/0!" which I replace as NA when data is read. All missing data has no use in prediction, I check to see any column with all missing data which is also a subject to remove.
The following code is refered from stackoverflow

```{r}
 df1 <- read.csv("pml-training.csv", na.strings=c("#DIV/0!") )
 df2 <- read.csv("pml-testing.csv", na.strings=c("#DIV/0!") )

#To find the columns with all values missing

 allmisscols <- apply(dataset,2, function(x)all(is.na(x)));  
 colswithallmiss <-names(allmisscols[allmisscols>0]);    
 print("the columns with all values missing");    
 print(colswithallmiss);
```
 First column seems to indicate order of data, 6 following columns have no use for the purpose of this project also eliminate.  
```{r}
features <- colnames(df1[colSums(is.na(df1)) == 0])[-c(1:7)]
df1 <- df1[features]
str(df1)
```
 Further investigation reveals many numeric columns but in form of factor. That leads us to convert to numerical value.
```{r}
df1<- as.data.frame(lapply(df1,as.numeric))
dim(df1)
```
Now we have data frame with 120 columns and 19622 data examples. Let load libraries for data mining
```{r}
#library(Hmisc)
library(caret)
library(randomForest)
library(foreach)
library(doParallel)
```
First step to create training and testing data using caret package
```{r}
TrainIndex <- createDataPartition(y=df1$classe, p=0.75, list=FALSE )
trainDat <- df1[TrainIndex,]
testDat <- df1[-TrainIndex,]

```
We try random forests which can make use parallel processing to reduce run time using doParallel package. we can build 5 random forest with 150 trees each.
```{r}
registerDoParallel()
trainx <- trainDat[-ncol(trainDat)]
trainy <- trainDat$classe

rf <- foreach(ntree=rep(150, 10), .combine=randomForest::combine, .packages='randomForest') %dopar% {
randomForest(trainx, trainy, ntree=ntree) 
}
```
```

Evaluate on test data.
```{r}

prediction <- predict(rf, newdata=testDat)
confusionMatrix(round(prediction),testDat$classe)
```
Validate the result on set of test data (20 values)
```{r}
 
df2 <- df2[features[features!='classe']]
answers <- predict(rf, newdata=df2)

answers

